// Parameter Def
// online=false
online=true

zoom_min=10
zoom_max=19

// Variable Def

// * city_1
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_1="Osnabrueck"
var city_1_vis = "vis/index_city_1.html"
var city_1_label_1 = "Osnabrueck, Germany"
var city_1_label_2 = "| 1 Year 2 Months"
var city_1_label_3 = "|| Growing Up"
var city_1_coordinate_1 = 52.2799
var city_1_coordinate_2 = 8.0472

if (online==true) {
   var city_1_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_1+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_1_url = "image/map_img/image_1.png"
}

// * city_2
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_2="Wiesbaden"
var city_2_vis = "vis/index_city_2.html"
var city_2_label_1 = "Wiesbaden, Germany"
var city_2_label_2 = "| 1 Year 3 Months"
var city_2_label_3 = "|| Growing Up"
var city_2_coordinate_1 = 50.0782
var city_2_coordinate_2 = 8.2398

if (online==true) {
   var city_2_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_2+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_2_url = "image/map_img/image_2.png"
}

// * city_3
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_3="Kassel"
var city_3_vis = "vis/index_city_3.html"
var city_3_label_1 = "Kassel, Germany"
var city_3_label_2 = "| 2 Years 3 Months"
var city_3_label_3 = "|| Growing Up"
var city_3_coordinate_1 = 51.2848
var city_3_coordinate_2 = 9.6203

if (online==true) {
   var city_3_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_3+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_3_url = "image/map_img/image_3.png"
}

// * city_4
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_4="Karlsruhe,Waldstadt"
var city_4_vis = "vis/index_city_4.html"
var city_4_label_1 = "Karlsruhe, Germany"
var city_4_label_2 = "| 1 Year 8 Months"
var city_4_label_3 = "|| Kindergarten"
var city_4_coordinate_1 = 49.0424
var city_4_coordinate_2 = 8.4268

if (online==true) {
   var city_4_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_4+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_4_url = "image/map_img/image_4.png"
}

// * city_5
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_5="Karlsruhe"
var city_5_vis = "vis/index_city_5.html"
var city_5_label_1 = "Karlsruhe, Germany"
var city_5_label_2 = "| 4 Years 1 Month"
var city_5_label_3 = "|| Primary School"
var city_5_coordinate_1 = 49.0069
var city_5_coordinate_2 = 8.4037

if (online==true) {
   var city_5_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_5+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_5_url = "image/map_img/image_5.png"
}

// * city_6
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_6="Copenhagen"
var city_6_vis = "vis/index_city_6.html"
var city_6_label_1 = "K\u00F8benhavn, Denmark"
var city_6_label_2 = "| 1 Year"
var city_6_label_3 = "|| Middle School"
var city_6_coordinate_1 = 55.6761
var city_6_coordinate_2 = 12.5683

if (online==true) {
   var city_6_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_6+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_6_url = "image/map_img/image_6.png"
}

// * city_7
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_7="Karlsruhe"
var city_7_vis = "vis/index_city_7.html"
var city_7_label_1 = "Karlsruhe, Germany"
var city_7_label_2 = "| 1 Year"
var city_7_label_3 = "|| Middle School"
var city_7_coordinate_1 = 49.0069
var city_7_coordinate_2 = 8.4037

if (online==true) {
   var city_7_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_7+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_7_url = "image/map_img/image_7.png"
}

// * city_8
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_8="Frankfurt"
var city_8_vis = "vis/index_city_8.html"
var city_8_label_1 = "Frankfurt, Germany"
var city_8_label_2 = "| 1 Year 9 Months"
var city_8_label_3 = "|| Middle School"
var city_8_coordinate_1 = 50.1109
var city_8_coordinate_2 = 8.6821

if (online==true) {
   var city_8_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_8+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_8_url = "image/map_img/image_8.png"
}

// * city_9
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_9="Kaifaqu"
var city_9_vis = "vis/index_city_9.html"
var city_9_label_1 = "\u5F00\u53D1\u533A (Kaifaqu), China"
var city_9_label_2 = "| 1 Year 3 Months"
var city_9_label_3 = "|| High School"
var city_9_coordinate_1 = 39.0536
var city_9_coordinate_2 = 121.7746

if (online==true) {
   var city_9_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_9+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_9_url = "image/map_img/image_9.png"
}

// * city_10
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_10="Beijing"
var city_10_vis = "vis/index_city_10.html"
var city_10_label_1 = "\u5317\u4EAC (Beijing), China"
var city_10_label_2 = "| 1 Year 9 Months"
var city_10_label_3 = "|| School Graduation"
var city_10_coordinate_1 = 39.9042
var city_10_coordinate_2 = 116.4074

if (online==true) {
   var city_10_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_10+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_10_url = "image/map_img/image_10.png"
}

// * city_11
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_11="Dalian"
var city_11_vis = "vis/index_city_11.html"
var city_11_label_1 = "\u5927\u8FDE (Dalian), China"
var city_11_label_2 = "| 7 Months"
var city_11_label_3 = "|| Working"
var city_11_coordinate_1 = 38.914
var city_11_coordinate_2 = 121.6147

if (online==true) {
   var city_11_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_11+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_11_url = "image/map_img/image_11.png"
}

// * city_12
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_12="Jiashan,Gansu"
var city_12_vis = "vis/index_city_12.html"
var city_12_label_1 = "\u67B6\u5C71 (Jiashan) China"
var city_12_label_2 = "| 3 Months"
var city_12_label_3 = "|| Working"
var city_12_coordinate_1 = 33.7688
var city_12_coordinate_2 = 106.0878

if (online==true) {
   var city_12_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_12+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_12_url = "image/map_img/image_12.png"
}

// * city_13
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_13="Beijing"
var city_13_vis = "vis/index_city_13.html"
var city_13_label_1 = "\u5317\u4EAC (Beijing), China"
var city_13_label_2 = "| 5 Months"
var city_13_label_3 = "|| Working"
var city_13_coordinate_1 = 39.9042
var city_13_coordinate_2 = 116.4074

if (online==true) {
   var city_13_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_13+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_13_url = "image/map_img/image_13.png"
}

// * city_14
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_14="Cambridge"
var city_14_vis = "vis/index_city_14.html"
var city_14_label_1 = "Cambridge, UK"
var city_14_label_2 = "| 2 Years 5 Months"
var city_14_label_3 = "|| University (BA)"
var city_14_coordinate_1 = 52.2053
var city_14_coordinate_2 = 0.1218

if (online==true) {
   var city_14_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_14+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_14_url = "image/map_img/image_14.png"
}

// * city_15
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;

var city_15="PhnomPenh"
var city_15_vis = "vis/index_city_15.html"
var city_15_label_1 = "\u1797\u17D2\u1793\u17C6\u1796\u17C1\u1789 (Phnom Penh), CM"
var city_15_label_2 = "| 3 Months"
var city_15_label_3 = "|| Working"
var city_15_coordinate_1 = 11.556374
var city_15_coordinate_2 = 104.9282

if (online==true) {
   var city_15_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_15+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_15_url = "image/map_img/image_16.png"
}

// * city_16
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_16="London"
var city_16_vis = "vis/index_city_16.html"
var city_16_label_1 = "London, UK"
var city_16_label_2 = "| 3 Months"
var city_16_label_3 = "|| Working"
var city_16_coordinate_1 = 51.5074
var city_16_coordinate_2 = -0.1278

if (online==true) {
   var city_16_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_16+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_16_url = "image/map_img/image_15.png"
}


// * city_17
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_17="Cambridge,MA"
var city_17_vis = "vis/index_city_17.html"
var city_17_label_1 = "Cambridge, US"
var city_17_label_2 = "| 8 Months"
var city_17_label_3 = "|| University (MA)"
var city_17_coordinate_1 = 42.3736
var city_17_coordinate_2 = -71.1097

if (online==true) {
   var city_17_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_17+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_17_url = "image/map_img/image_17.png"
}

// * city_18
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_18="SanFrancisco"
var city_18_vis = "vis/index_city_18.html"
var city_18_label_1 = "San Francisco, US"
var city_18_label_2 = "| 6 Months"
var city_18_label_3 = "|| Founding A Company"
var city_18_coordinate_1 = 37.7749
var city_18_coordinate_2 = -122.4194

if (online==true) {
   var city_18_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_18+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_18_url = "image/map_img/image_18.png"
}

// * city_19
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_19="Somerville"
var city_19_vis = "vis/index_city_19.html"
var city_19_label_1 = "Somerville, US"
var city_19_label_2 = "| 1 Year 5 Months"
var city_19_label_3 = "|| Working"
var city_19_coordinate_1 = 42.3876
var city_19_coordinate_2 = -71.0995

if (online==true) {
   var city_19_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_19+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_19_url = "image/map_img/image_19.png"
}

// * city_20
zoom = Math.floor(Math.random() * (zoom_max - zoom_min + 1)) + zoom_min;
var city_20="Chicago"
var city_20_vis = "vis/index_city_20.html"
var city_20_label_1 = "Chicago, US"
var city_20_label_2 = "| 1 Year 5 Months"
var city_20_label_3 = "|| Working"
var city_20_coordinate_1 = 41.8781
var city_20_coordinate_2 = -87.6298

if (online==true) {
   var city_20_url = "https://maps.googleapis.com/maps/api/staticmap?center="+city_20+"&zoom="+zoom+"&size=600x300&maptype=satellite&key=ABQIAAAATfHumDbW3OmRByfquHd3SRTRERdeAiwZ9EeJWta3L_JZVS0bOBRQeZgr4K0xyVKzUdnnuFl8X9PX0w"
} else {
   var city_20_url = "image/map_img/image_20.png"
}

// Function Def #1
function draw_globe(globe_data, city_label_1,city_label_2,city_label_3, city_coordinate_1, city_coordinate_2, city_index) {
var width  = 820;
var height = 620;


var projection = d3.geo.orthographic()
    .translate([(width / 2) -350, (height / 2)-250])
    .scale(60)
    .clipAngle(90)
    .precision(0.3);

var canvas = d3.select("body").append("canvas")
    .attr("width", width)
    .attr("height", height);

var c = canvas.node().getContext("2d");
c.textAlign = "start"
c.textBaseline = "hanging"


            c.fillStyle = "white";
            
            c.font = "9px Lucida Grande";
             c.fillText("LOADING",50,50);

var path = d3.geo.path()
    .projection(projection)
    .context(c);

var title = d3.select("h1");

queue()
    .defer(d3.json, "../data/world-110m.json")
    .defer(d3.json, "../data/cities.geojson")
    .defer(d3.json, "../data/cities_all.geojson")
    .defer(d3.json, globe_data)
    .await(ready);

function ready(error, world, cities_all_pop, cities_all, cities) {
  if (error) throw error;
var rScale = d3.scale.sqrt();
var peoplePerPixel = 1000000;
var max_population = [];


         population_array = [];
         for (i = 0; i < cities_all_pop.features.length; i++) {
            population_array.push(cities_all_pop.features[i].properties.population);
         }
         max_population = population_array.sort(d3.descending)[0]
         var rMin = 0;
         var rMax = Math.sqrt(max_population / (peoplePerPixel * Math.PI));
         rScale.domain([0, max_population]);
         rScale.range([rMin, rMax]);

         path.pointRadius(function(d) {
            return d.properties ? rScale(d.properties.population) : 1;

         });

  var globe = {type: "Sphere"},
      land = topojson.feature(world, world.objects.land),
      cities = topojson.feature(cities, cities.objects.globe),
      cities_all = topojson.feature(cities_all, cities_all.objects.globe),
      borders = topojson.mesh(world, world.objects.countries, function(a, b) { return a !== b; }),
      i = -1,
      n = 100;

  (function transition() {
    d3.transition()
        .duration(3250)
        .each("start", function() {
        })
        .tween("rotate", function() {
          var p = [city_coordinate_2,city_coordinate_1],
              r = d3.interpolate(projection.rotate(), [-p[0], -p[1]]);
          return function(t) {
            projection.rotate(r(t));
            c.clearRect(0, 0, width, height);
                        c.fillStyle = "#1a4400", c.beginPath(), path(cities_all), c.fill();

            c.fillStyle = "#1c33ff", c.beginPath(), path(cities.features[city_index]), c.fill();

            c.strokeStyle = "#fff", c.lineWidth = .5, c.beginPath(), path(borders), c.stroke();
            c.strokeStyle = "white", c.lineWidth = 2, c.beginPath(), path(globe), c.stroke();
            c.fillStyle = "white";
            
            c.font = "9px Lucida Grande";
            c.save();
            c.translate(85,160);
            c.rotate(-0.5*Math.PI);
            
            c.fillText(city_label_1,50,50);
            c.restore();
            
            
            c.save();
            c.translate(100,160);
            c.rotate(-0.5*Math.PI);
            
            c.fillText(city_label_2,50,50);
            c.restore();
            
            
            c.save();
            c.translate(115,160);
            c.rotate(-0.5*Math.PI);
            
            c.fillText(city_label_3,50,50);
            c.restore();
            

          };
        })
      .transition()
        .each("end", transition);
  })();
}

d3.select(self.frameElement).style("height", height + "px");

}
